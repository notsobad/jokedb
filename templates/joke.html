{% extends "base.html" %}
{% autoescape None %}

{% block body %}
<script>
var pk = '{{ item["_id"] }}';
var api_vote = '{{ reverse_url("api-vote") }}';
$(function(){
	$.cookie('pk', pk, {expires:365, path:'/'});

	$('.vote a').click(function(){
		if($(this).hasClass('disabled')){
			return;
		}
		var act = $(this).hasClass('upvote') ? 'up' : 'down';
		$('.vote a').addClass('disabled');

		$.post(api_vote, {'act':act, 'pk':pk}, function(){
			location.reload();
		});
	});
});

</script>
<div class="row">
	<div class="col-md-7">
		<article class="main cont">
			<p class="">{{ item['cont'].replace('\n', '<br/>') }}</p>

		</article>
		<div class="control-area">
			<div class="">
				<i><a class="btn btn-danger btn-xs" href="{{ reverse_url('delete', item['_id']) }}">Del</a></i>
				<i><a class="btn btn-info btn-xs" href="{{ reverse_url('edit', item['_id']) }}">Edit</a></i>
			</div>
			<div class="vote">
				<a class="downvote btn btn-danger btn-xs">
					<span class="glyphicon glyphicon-thumbs-down"></span>  
					{{ item.get('down', 0) }}
				</a>
				<a class="upvote btn btn-success btn-xs">
					<span class="glyphicon glyphicon-thumbs-up"></span>  
					{{ item.get('up', 0) }}
				</a>
			</div>
		</div>
		<hr/>
		<div class="navgate">
			<a class="downvote btn btn-default btn-large" href="{{ reverse_url('joke', next_pk) }}">
				<span class="glyphicon glyphicon-chevron-left"></span>  
				上一条
			</a>
			<a class="btn btn-default btn-large" href="{{ reverse_url('random_page') }}">
			  <span class="glyphicon glyphicon-random"></span>  随便看看
			</a>
			<a class="upvote btn btn-default btn-large" href="{{ reverse_url('joke', next_pk) }}">
				下一条
				<span class="glyphicon glyphicon-chevron-right"></span>  
			</a>
		</div>

	</div>
	<div class="col-md-5">
		<table class="table joke-info">
				<tr>
					<td>来源</td>
					<td>{{ item['source'] }}</td>
				</tr>
				<tr>
					<td>HASH</td>
					<td>{{ item['md5'] }}</td>
				</tr>
				<tr>
					<td>UP vote</td>
					<td>{{ item.get('up', 0) }}</td>
				</tr>
				<tr>
					<td>DOWN vote</td>
					<td>{{ item.get('down', 0) }}</td>
				</tr>
				<tr>
					<td>RANK</td>
					<td>{{ item.get('rank', 0) }}</td>
				</tr>
				<tr>
					<td>永久网址</td>
					<td><a href="{{ reverse_url('joke', item['_id']) }}">{{ reverse_url('joke', item['_id']) }}</a></td>
				</tr>
		</table>
		{% comment include "widget/about_box.html" %}
		{% include "widget/search_box.html" %}
	</div>
</div>
{% comment include "widget/jiathis.html" %}
{% end %}
